steps:
    - name: transcription
      type: audio_transcription
      description: Transcribe an audio file into text
      file: "{{ input_file }}"

    - name: journal_cleanup
      type: llm
      description: Remove filler words, self-cancels, and fix punctuation
      model:
          name: gpt-4.1
          temperature: 0
      prompt:
          - role: system
            content: |
                You are proofreading a journal transcript from an audio-to-text model (GPT-4o).

                Your instructions:

                - **Keep all my original words and tone.**
                - **Remove only filler words** like "um," "uh," "like" (when unnecessary), "you know," etc.
                - **Fix formatting**:
                  - Break text into frequent, natural-sized paragraphs, following topic shifts. Avoid very long paragraphs (no more than 200 words).
                  - Italicize titles of books, films, albums, and other works.
                - **Do not** reword, paraphrase, or remove ANY content aside from disfluencies and changing punctuation.

          - role: user
            content: "{{ transcription }}"

    - name: journal_headers
      type: add_headers
      description: Add section headers to organize the journal text
      input: "{{ journal_cleanup }}"
      model:
          name: gpt-5.2
          temperature: 0
      system_prompt: |
          You analyze a journal entry and identify where to place Markdown headers.

          Each header title should spark recognition when skimming weeks later. For routine segments a simple label is fine; when something is distinctive, capture a salient detail from the text.

          FORMATTING:
          - Use standard Title Case: capitalize major words; keep articles, short prepositions, and conjunctions (a, an, the, in, on, at, to, of, for, with, and, but, or) lowercase unless they start the title.
          - Keep titles concise: 3–5 words, 6 at most. Name the single dominant subject directly — skip framing words like "Reflections", "Thoughts", or activity verbs like "Watching" or "Making".
          - If a paragraph opens with a brief routine activity (like going to the gym) before moving on to the real content, ignore the routine activity in the title.
          - When an activity is shared with a specific person, include their name: "The Last of Us With Amber", not just "The Last of Us".

          PLACEMENT:
          - Add a level-3 header (###) for each primary segment of the day: a distinct shift in scene, activity, or company.
          - A section boundary requires a literal change in location, activity, or company — not a shift in subject matter. If consecutive paragraphs are part of the same phone call, conversation, or uninterrupted train of thought, they are one section regardless of how many topics are covered.
          - Add level-4 sub-headers (####) only within complex events that have clearly distinguishable phases worth remembering. Do not fragment simple moments.
          - Do not add a header before paragraph 0 if it is a short date/time preamble.

    - name: make_links
      type: auto_wikilink
      entity_types:
          - type: person
            files:
                - Tags/People/*
                - "*"
          - type: movie
            files:
                - Catalogs/Movies/**
          - type: tv_show
            files:
                - Catalogs/Shows/**
          - type: music
            files:
                - Catalogs/Music/**
          - type: places
            files:
                - Catalogs/Places/**
          - type: projects
            description: "Concrete personal projects — things like woodworking, 3D printing, gift planning, or personal software projects I'm building. Not professional work tools, software I'm using, or named instances of things like terminals or AI agents."
            files:
                - Projects/2026/**
                - Internal Projects/**
      input: "{{ journal_headers }}"

    - name: final
      type: templating
      template: |
          {{ make_links }}
