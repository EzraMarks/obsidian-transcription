steps:
    - name: transcription
      type: audio_transcription
      description: Transcribe an audio file into text
      file: "{{ input_file }}"

    - name: journal_cleanup
      type: llm
      description: Remove filler words, self-cancels, and fix punctuation
      model:
          name: gpt-4.1
          temperature: 0
      prompt:
          - role: system
            content: |
                You are proofreading a journal transcript from an audio-to-text model (GPT-4o).

                Your instructions:

                - **Keep all my original words and tone.**
                - **Remove only filler words** like "um," "uh," "like" (when unnecessary), "you know," etc.
                - **Fix formatting**:
                  - Break text into frequent, natural-sized paragraphs, following topic shifts. Avoid very long paragraphs (no more than 200 words).
                  - Italicize titles of books, films, albums, and other works.
                - **Do not** reword, paraphrase, or remove ANY content aside from disfluencies and changing punctuation.

          - role: user
            content: "{{ transcription }}"

    - name: journal_headers
      type: add_headers
      description: Add section headers to organize the journal text
      input: "{{ journal_cleanup }}"
      model:
          name: gpt-5.2
          temperature: 0
      system_prompt: |
          You analyze a journal entry and identify where to place Markdown headers.

          Each header title should spark recognition when skimming weeks later. A simple label is fine for routine segments. Only add a specific detail when it's genuinely insightful or memorable — not just to fill space, note who happened to be present, or add commentary about an activity that already speaks for itself.

          FORMATTING:
          - Use standard Title Case: capitalize major words; keep articles, short prepositions, and conjunctions (a, an, the, in, on, at, to, of, for, with, and, but, or) lowercase unless they start the title.
          - Keep titles concise: 3–5 words, 6 at most. Name the single dominant subject directly — skip framing words like "Reflections", "Thoughts", or activity verbs like "Watching" or "Making".
          - Describe what happened — name the activity or subject directly. Do not interpret or impose a frame on the author's experience.
          - If a paragraph opens with a brief routine activity (like going to the gym) before moving on to the real content, ignore the routine activity in the title.
          - When an activity is shared with a specific person, include their name: "The Last of Us With Amber", not just "The Last of Us".

          PLACEMENT:
          - Add a level-3 header (###) for each major block of the day — things like the workday, an evening at home, dinner out, or a social event. A typical day has 2–4 sections, though complex days may have more. Minor location changes within a block (moving from desk to lunch line, gym to office, office to a walk home with coworkers) do not create a new section.
          - A shift in subject, mood, or topic is never a section boundary.
          - Err strongly on the side of fewer sections. A single paragraph at the end of an entry doesn't need its own section unless it clearly introduces a new activity or topic — a brief closing remark or afterthought doesn't warrant a header.
          - Add level-4 sub-headers (####) only for a specific, self-contained incident that clearly interrupts or stands apart from the surrounding activity — not for different aspects, moods, or phases of the same continuous experience. These should be rare.
          - Do not add a header before paragraph 0 if it is a short date/time preamble.

    - name: make_links
      type: auto_wikilink
      entity_types:
          - type: person
            files:
                - Tags/People/*
                - "*"
          - type: movie
            files:
                - Catalogs/Movies/**
          - type: tv_show
            files:
                - Catalogs/Shows/**
          - type: music
            files:
                - Catalogs/Music/**
          - type: places
            files:
                - Catalogs/Places/**
          - type: projects
            description: "Concrete personal projects — things like woodworking, 3D printing, gift planning, or personal software projects I'm building. Not professional work tools, software I'm using, or named instances of things like terminals or AI agents."
            files:
                - Projects/2026/**
                - Internal Projects/**
      input: "{{ journal_headers }}"

    - name: final
      type: templating
      template: |
          {{ make_links }}
